@model PromotionEditorModel

<script>
    $(function () {

        var model = {};

        ko.mapping.fromJS(@(Html.Raw(Model.ToJson(PropertyNaming.CamelCase))), {}, model);

        ko.applyBindings(model, document.getElementById('basic-info'));

        $(':input[name="StartTime"],:input[name="EndTime"]').each(function () {
            $(this).datetimepicker({
                controlType: 'select',
                dateFormat: 'yy/mm/dd',
                timeFormat: 'HH:mm',
                onClose: function () {
                    $(this).trigger("datetimepicker.blur");
                }
            });
        });

        // Coupon code
        var $requireCoupon = $(':checkbox[name="RequireCouponCode"]');

        onRequireCouponCodeChanged($requireCoupon.is(':checked'));

        $requireCoupon.click(function () {
            onRequireCouponCodeChanged($(this).is(':checked'));
        });

        function onRequireCouponCodeChanged(required) {
            if (required) {
                $('.J_CouponcodeHolder').show();
            } else {
                $('.J_CouponcodeHolder').hide();
            }
        }

        // Overlapping Usage Dropdown

        var $overlappingUsage = $('select[name="OverlappingUsage"]');

        onOverlappingUsageChanged($overlappingUsage.val());

        $overlappingUsage.change(function () {
            onOverlappingUsageChanged($(this).val());
        });

        function onOverlappingUsageChanged(value) {
            if (value == 'AllowedWithSpecifiedPromotions') {
                $('#J_OtherPromotions').show();
            } else {
                $('#J_OtherPromotions').hide();
            }
        }

        // Conditions Editing
        var dataContextType = '@Html.Raw(typeof(Kooboo.Commerce.Promotions.PromotionConditionContextModel).AssemblyQualifiedNameWithoutVersion())';

        ConditionsDialog.instance().setDataContextType(dataContextType);
        ConditionsDialog.instance().onSubmitted = function (conditions) {
            model.conditionsJson(JSON.stringify(conditions));
            model.conditions.removeAll();
            $.each(conditions, function () {
                model.conditions.push(ko.mapping.fromJS(this));
            });
        };

        $('.btn-edit-conditions').on('click', function () {
            var conditions = ko.mapping.toJS(model.conditions());
            ConditionsDialog.instance().open({
                title: '@("Promotion Conditions".Localize())',
                conditions: conditions
            });
            return false;
        });
    });
</script>