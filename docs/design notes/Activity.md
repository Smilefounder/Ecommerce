# Activity Design Notes #

## Execute方法返回值 ##

当前`IActivity.Execute`方法没有返回值，签名如下:

	void Execute(IEvent @event, ActivityContext context);

曾经有讨论过让`Execute`方法返回`bool`或枚举来表示是否继续或中断执行。
但经过一些试验，目前感觉似乎不返回值，改用异常是比较合适的，有时间时可以再讨论一下。

**不返回值的原因:**

1. 假如返回`bool`来表示是否继续，且某个Activity返回了`false`，那流程中断，但问题是，我们应该怎么给用户以提示呢？如果提示“对不起，因为某个原因，你的操作无法继续”，那用户会摸不着头脑，是因为我不是VIP，还是因为我购买的产品数据不够？`bool`类型的返回值无法提供更多的信息。

2. 返回`bool`要求`IActivity.Execute`方法的调用处必须处理好返回值，而漏处理返回值是比较容易犯的错误。

**目前的改进策略：**

使用异常来报告错误。如果Activity在执行时发现业务规则不符合要求，则它要抛出`BusinessRuleViolationException`异常，抛出该异常可以分别解决上面提到的两个缺陷：

1. 异常中可以带异常消息，因为调用方可以将信息提供给用户，而通常**未处理**的异常是不会直接显示给用户的，因此使用自定义的`BusinessRuleViolationException`来表示这是一个违反业务规则的异常，这样便可以安全的显示该异常信息。

2. 因为异常抛出后，后面的代码必然无法继续，这是由.NET来保证的，因此，即便我们漏处理了该异常，也不会造成严重的后果（例如数据一致性被破坏），最多就是多一个bug。